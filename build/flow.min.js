/**
 * https://github.com/sunag/flow
 */
function __flow__addCSS(e){try{const t=document.createElement("style");t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t)}catch(e){}}__flow__addCSS("f-canvas,f-canvas canvas { position: absolute; top: 0; left: 0; margin: 0; padding: 0; width: 100%; height: 100%; -webkit-touch-callout: none; }f-canvas { overflow: auto; cursor: grab;}f-canvas canvas.front { z-index: 10;}body.dragging f-canvas,body.connecting f-canvas { overflow: hidden !important;}body.dragging *:not(.drag) { pointer-events: none !important;}f-canvas.grabbing * { cursor: grabbing; user-select: none;}f-canvas canvas { position: fixed; overflow: hidden; pointer-events: none;}f-canvas::-webkit-scrollbar { width: 8px; height: 8px;}f-canvas::-webkit-scrollbar-thumb:hover{ background: #014fc5;}f-canvas::-webkit-scrollbar-track { background: #363636;}f-canvas::-webkit-scrollbar-thumb { background-color: #666666; border-radius: 10px; border: 0;}f-canvas f-content,f-canvas f-area { position: absolute; display: block;}f-node { position: absolute; margin: 0; padding: 0; user-select: none; width: 320px; z-index: 1; cursor: auto; filter: drop-shadow(0 0 10px #00000061); backdrop-filter: blur(4px);}f-node.selected { z-index: 2;}f-node.selected,f-canvas.dragging-output f-node:hover,f-canvas.dragging-input f-node:hover { filter: drop-shadow(0 0 10px #00000061) drop-shadow(0 0 8px #4444dd);}f-node.closed f-element:not(:first-child) { display: none;}f-node.center { top: 50%; left: 50%; transform: translate( -50%, -50% );}f-node.top-right { top: 0; right: 0;}f-node.top-center { top: 0; left: 50%; transform: translateX( -50% );}f-node.top-left { top: 0; left: 0;}f-node { transition: filter 0.2s ease;}f-menu,f-menu button,f-element,f-element input,f-element select,f-element button,f-element textarea { font-family: 'Open Sans', sans-serif; font-size: 13px; color: #eeeeee; outline: solid 0px #000; letter-spacing: .2px; margin: 0; padding: 0; border: 0; user-select: none; -webkit-tap-highlight-color: transparent; transition: background 0.2s ease;}f-element input { transition: background 0.1s ease;}f-element input,f-element select,f-element button,f-element textarea { background-color: #242427;}f-element { position: relative; width: calc( 100% - 14px ); background: rgba(45, 45, 48, 0.95); pointer-events: auto; border-bottom: 2px solid #232323; display: flex; padding-left: 7px; padding-right: 7px; padding-top: 2px; padding-bottom: 2px;}f-element { height: 24px;}f-element input { margin-top: 2px; margin-bottom: 2px; box-shadow: inset 0px 1px 1px rgb(0 0 0 / 20%), 0px 1px 0px rgb(255 255 255 / 5%); margin-left: 2px; margin-right: 2px; width: inherit; padding-left: 4px; padding-right: 4px;}f-element input.number { cursor: col-resize;}f-element input:focus[type='text'], f-element input:focus[type='range'], f-element input:focus[type='color'] { background: rgba( 0, 0, 0, 0.6 ); outline: solid 1px rgba( 0, 80, 200, 0.98 );}f-element input[type='color'] { appearance: none; padding: 0; margin-left: 2px; margin-right: 2px; height: calc( 100% - 4px ); margin-top: 2px; border: none; }f-element input[type='color']::-webkit-color-swatch-wrapper { padding: 2px;}f-element input[type='color']::-webkit-color-swatch { border: none; cursor: alias;}f-element input[type='range'] { appearance: none; width: 100%; overflow: hidden; padding: 0; cursor: ew-resize;}f-element input[type='range']::-webkit-slider-runnable-track { appearance: none; height: 10px; color: #13bba4; margin: 0;}f-element input[type='range']::-webkit-slider-thumb { appearance: none; width: 0; background: #434343; box-shadow: -500px 0 0 500px rgba( 0, 120, 255, 0.98 ); border-radius: 50%; border: 0 !important;}f-element input[type='range']::-webkit-slider-runnable-track { margin-left: -4px; margin-right: -5px;}f-element input[type='checkbox'] { appearance: none; cursor: pointer;}f-element input[type='checkbox'].toggle { height: 20px; width: 45px; border-radius: 16px; display: inline-block; position: relative; margin: 0; margin-top: 3px; background: linear-gradient( 0deg, #292929 0%, #0a0a0ac2 100% ); transition: all 0.2s ease;}f-element input[type='checkbox'].toggle:after { content: \"\"; position: absolute; top: 2px; left: 2px; width: 16px; height: 16px; border-radius: 50%; background: white; box-shadow: 0 1px 2px rgba(44, 44, 44, 0.2); transition: all 0.2s cubic-bezier(0.5, 0.1, 0.75, 1.35);}f-element input[type='checkbox'].toggle:checked { background: linear-gradient( 0deg, #0177fb 0%, #0177fb 100% );}f-element input[type='checkbox'].toggle:checked:after { transform: translatex(25px);}f-element.auto-height { display: table;}f-element textarea { width: calc( 100% - 18px ); padding-top: 1px; padding-bottom: 3px; padding-left: 3px; padding-right: 8px; margin-top: 2px; margin-left: 2px; height: calc( 100% - 8px ); max-height: 300px; border-radius: 2px; resize: none; box-shadow: inset 0px 1px 1px rgb(0 0 0 / 20%), 0px 1px 0px rgb(255 255 255 / 5%);}f-element.auto-height textarea { resize: auto;}f-element select { width: 100%; margin-top: 2px; margin-bottom: 2px; margin-left: 2px; margin-right: 2px; padding-left: 5px; cursor: pointer; box-shadow: inset 0px 1px 1px rgb(0 0 0 / 20%), 0px 1px 0px rgb(255 255 255 / 5%);}f-element f-toolbar { position: absolute; display: flex; float: right; right: 7px; top: 0; width: 100%; height: 100%; justify-content: end; align-content: space-around;}f-element f-toolbar { margin-top: auto; margin-bottom: auto; margin-left: 3px; margin-right: 3px; font-size: 18px; line-height: 18px;}f-element f-toolbar button { opacity: .7; cursor: pointer; font-size: 14px; width: unset; height: unset; border-radius: unset; border: unset; outline: 0; background-color: unset; box-shadow: unset;}f-element f-toolbar button:hover,f-element f-toolbar button:active { opacity: 1; border: 0; background-color: unset;}f-element input.range-value { width: 60px; text-align: center;}f-menu.context button,f-element button { width: 100%; height: calc( 100% - 4px ); margin-left: 2px; margin-right: 2px; margin-top: 2px; border-radius: 3px; cursor: pointer;}f-element button { box-shadow: inset 1px 1px 1px 0 rgb(255 255 255 / 17%), inset -2px -2px 2px 0 rgb(0 0 0 / 26%);}f-element button:hover { color: #fff; background-color: #2a2a2a;}f-element button:active { border: 1px solid rgba( 0, 120, 255, 0.98 );}f-element f-inputs,f-element f-subinputs { display: flex; width: 100%;}f-element f-inputs { padding-left: 30px;}f-element f-label,f-element span { margin: auto; text-shadow: 1px 1px 0px #0007;}f-element f-label { padding-left: 4px;}f-element f-label { white-space: nowrap; width: 130px;}f-element f-label i { float: left; font-size: 16px; margin-right: 4px;}f-element f-label.center { width: 100%; text-align: center; display: block;}f-element.title { height: 29px; background-color: #3a3a3ab0; background-color: #3b3b43ed; cursor: all-scroll; border-top-left-radius: 6px; border-top-right-radius: 6px;}f-element.blue { background-color: #014fc5;}f-element.title.left { text-align: left; display: inline-grid; justify-content: start;}f-element.title span { text-align: center; font-size: 15px; padding-top: 2px;}f-element.title i { font-size: 18px; position: absolute; left: 10px; top: 50%; transform: translateY(-50%); opacity: .5;}f-element.title.left span { text-align: left;}f-element f-io { border: 2px solid #dadada; width: 7px; height: 7px; position: absolute; background: #242427; border-radius: 8px; float: left; left: -7px; top: calc( 50% - 5px ); cursor: alias; box-shadow: 0 0 3px 2px #0000005e; z-index: 1;}f-element f-io.connect,f-canvas.dragging-output f-element:hover f-io.input,f-canvas.dragging-input f-element:hover f-io.output { border: 2px solid #0177fb; zoom: 1.4;}f-node.io-connect f-io:not(.connect) { border: 2px solid #dadada !important; zoom: 1 !important;}f-element f-io.output { float: right; right: -7px; left: unset;}f-element f-disconnect { position: absolute; left: -35px; top: 50%; font-size: 22px; transform: translateY( -50% ); filter: drop-shadow(0 0 5px #000); text-shadow: 0px 0px 5px black; cursor: pointer;}f-element f-disconnect:hover { color: #ff3300;}f-element textarea::-webkit-scrollbar { width: 6px;}f-element textarea::-webkit-scrollbar-track { background: #111; } f-element textarea::-webkit-scrollbar-thumb { background: #0177fb; }f-element textarea::-webkit-scrollbar-thumb:hover { background: #1187ff; }f-element.small { height: 18px;}f-element.large { height: 36px;}body.connecting f-node:not(.io-connect) f-element:hover,f-element.select { background-color: rgba(61, 70, 82, 0.98);}f-tooltip { pointer-events: none;}f-menu.context { position: absolute; width: 170px; padding: 2px; margin: 0; background: #17171794; z-index: 110; font-size: 12px; border-radius: 6px; backdrop-filter: blur(6px); border: 1px solid #7e7e7e45; box-shadow: 3px 3px 6px rgba(0,0,0,.2);}f-menu.context.hidden { visibility: hidden;}f-menu.context f-item { display: block; position: relative; margin: 0; padding: 0; white-space: nowrap;}f-menu.context f-item.submenu::after { content: \"\"; position: absolute; right: 6px; top: 50%; -webkit-transform: translateY(-50%); transform: translateY(-50%); border: 5px solid transparent; border-left-color: #808080;}f-menu.context f-item:hover > f-menu { visibility: unset;}f-menu.context f-menu { top: 0px; left: calc( 100% - 4px );}f-menu.context f-item button { overflow: visible; display: block; width: calc( 100% - 6px ); text-align: left; cursor: pointer; white-space: nowrap; padding: 6px 8px; border-radius: 3px; background: #2d2d32; border: 0; color: #ddd; margin: 3px; text-shadow: 1px 1px 0px #0007;}f-menu.context f-item button i { float: left; font-size: 16px;}f-menu.context f-item button span { margin-left: 6px;}f-menu.context f-item:hover > button { color: #fff; background: #313136;}f-menu.context f-item button:active { outline: solid 1px rgba( 0, 80, 200, 0.98 );}f-menu.circle { position: absolute; left: 30px; top: 30px; z-index: 100;}f-menu.circle f-item { display: flex; justify-content: end; align-content: space-around; margin-bottom: 12px;}f-menu.circle f-item button { width: 50px; height: 50px; font-size: 26px; background: #17171794; border-radius: 50%; backdrop-filter: blur(6px); border: 1px solid #7e7e7e45; line-height: 100%; cursor: pointer; box-shadow: 3px 3px 6px rgba(0,0,0,.2);}f-menu.circle f-item f-tooltip { position: absolute; left: 0; top: 0; margin-left: 50px; background: rgba(0,0,0,.8); backdrop-filter: blur(4px); font-size: 14px; padding: 7px; border-radius: 10px; top: 50%; transform: translateY(-50%); visibility: hidden; pointer-events: none; opacity: 0; transition: all 0.3s ease;}f-menu.circle f-item button:hover { background-color: #2a2a2a;}f-menu.circle f-item button:hover > f-tooltip { visibility: visible; transform: translate(10px, -50%); opacity: 1;}flow.rounded f-node f-element,flow.rounded f-node f-element.title.left { border-radius: 10px 5px 10px 5px;}flow.rounded f-node f-element input, flow.rounded f-node f-element select,flow.rounded f-node f-element button,flow.rounded f-node f-element textarea,flow.rounded f-node f-element input[type='checkbox'].toggle,flow.rounded f-node f-element input[type='checkbox'].toggle:after { border-radius: 20px 10px;}flow.rounded f-node f-element input { padding-left: 7px; padding-right: 7px;}flow.rounded f-menu.context,flow.rounded f-menu.context f-item button { border-radius: 20px 10px;}@media (hover: hover) and (pointer: fine) { f-element f-io:hover { border: 2px solid #0177fb; zoom: 1.4; }}f-canvas { will-change: top, left;}f-node { will-change: transform !important;}"),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Flow={})}(this,(function(e){"use strict";var t=Object.freeze({__proto__:null,get Element(){return h},get Input(){return u},get Node(){return p},get Canvas(){return f},get Serializer(){return i},get Loader(){return x},get Utils(){return l},get PanelNode(){return z},get Menu(){return D},get ContextMenu(){return T},get CircleMenu(){return I},get DraggableElement(){return O},get LabelElement(){return M},get TitleElement(){return C},get ButtonInput(){return k},get ColorInput(){return E},get NumberInput(){return v},get SelectInput(){return _},get SliderInput(){return y},get StringInput(){return b},get TextInput(){return L},get ToggleInput(){return S}});let n=0;class i extends EventTarget{constructor(){super(),this._id=n++}get id(){return this._id}serialize(){console.warn("Serializer: Abstract function.")}deserialize(){console.warn("Serializer: Abstract function.")}toJSON(e=null){let t=null;const n=this.id;if(null!==e){const i=e.objects;t=i[n],void 0===t&&(t={objects:i},this.serialize(t),delete t.objects,i[n]=t)}else t={objects:{}},this.serialize(t);return t.id=n,t.type=this.constructor.name,t}}const s=(e,t=null,n="dragging")=>{let i=null;const s=t=>{const n=t.touches?t.touches[0]:t;t.stopImmediatePropagation(),i={client:{x:n.clientX,y:n.clientY},delta:{x:0,y:0},start:{x:e.offsetLeft,y:e.offsetTop},dragging:!1,isTouch:!!t.touches},window.addEventListener("mousemove",o),window.addEventListener("mouseup",r),window.addEventListener("touchmove",o),window.addEventListener("touchend",r)},o=s=>{const{start:o,delta:r,client:a}=i,l=s.touches?s.touches[0]:s,d=(()=>{let t=e;for(;t&&t!==document;){const e=t.style.zoom;if(e)return Number(e);t=t.parentNode}return 1})();r.x=(l.clientX-a.x)/d,r.y=(l.clientY-a.y)/d,i.x=o.x+r.x,i.y=o.y+r.y,!0===i.dragging?(null!==t?t(i):e.style.cssText+=`; left: ${i.x}px; top: ${i.y}px;`,s.stopImmediatePropagation()):(Math.abs(r.x)>1||Math.abs(r.y)>1)&&(i.dragging=!0,e.classList.add("drag"),n&&document.body.classList.add(n),s.stopImmediatePropagation())},r=a=>{a.stopImmediatePropagation(),e.classList.remove("drag"),n&&document.body.classList.remove(n),window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",r),window.removeEventListener("touchmove",o),window.removeEventListener("touchend",r),null===t&&(e.removeEventListener("mousedown",s),e.removeEventListener("touchstart",s)),i.dragging=!1,null!==t&&t(i)};if(e instanceof Event){const t=e;e=t.target,s(t)}else e.addEventListener("mousedown",s),e.addEventListener("touchstart",s)},o=(e,...t)=>{for(const n of e)n(...t)},r=e=>(!1===isNaN(e)&&(e=`${e}px`),e),a=e=>(!1===isNaN(e)&&(e=`#${e.toString(16).padStart(6,"0")}`),e);var l=Object.freeze({__proto__:null,draggableDOM:s,dispatchEventList:o,toPX:r,toHex:a});class d{constructor(e=null,t=null){this.sourceElement=e,this.targetElement=t}}let c=null;class h extends i{constructor(e=!1){super();const t=document.createElement("f-element");t.element=this;const n=e=>{let t=this;if(e.changedTouches&&e.changedTouches.length>0){const n=e.changedTouches[0];let i=document.elementFromPoint(n.clientX,n.clientY);for(;i&&(!i.element||!i.element.isElement);)i=i.parentNode;t=i?i.element:null}c=t};!1===e&&(t.ontouchstart=t.onmousedown=e=>{e.stopPropagation()}),t.addEventListener("mouseup",n,!0),t.addEventListener("touchend",n),this.inputs=[],this.links=[],this.dom=t,this.inputLength=0,this.outputLength=0,this.node=null,this.style="",this.inputsDOM=t,this.disconnectDOM=null,this.inputDOM=this._createIO("input"),this.outputDOM=this._createIO("output"),this.dom.appendChild(this.inputDOM),this.dom.appendChild(this.outputDOM)}setStyle(e){const t=this.dom;return this.style&&t.classList.remove(this.style),e&&t.classList.add(e),this.style=e,this}setInput(e){return this.inputLength=e,this.inputDOM.style.visibility=e>0?"":"hidden",this}setOutput(e){return this.outputLength=e,this.outputDOM.style.visibility=e>0?"":"hidden",this}add(e){return this.inputs.push(e),e.element=this,this.inputsDOM.appendChild(e.dom),this}setHeight(e){return this.dom.style.height=r(e),this}getHeight(){return this.dom.style.height}connect(e){return e.link(this),this}link(e=null){if(null!==this.disconnectDOM&&this.disconnectDOM.dispatchEvent(new Event("mousedown")),null!==e){const t=new d(e,this);if(this.links.push(t),null===this.disconnectDOM){this.disconnectDOM=document.createElement("f-disconnect"),this.disconnectDOM.innerText="✖",this.dom.appendChild(this.disconnectDOM);const e=e=>{e.stopPropagation(),this.links=[],this.dom.removeChild(this.disconnectDOM),this.disconnectDOM=null};this.disconnectDOM.addEventListener("mousedown",e,!0),this.disconnectDOM.addEventListener("touchstart",e,!0)}}return this.dispatchEvent(new Event("connect")),this}serialize(e){const t=this.getHeight(),n=[],i=[];for(const t of this.inputs)n.push(t.toJSON(e).id);for(const t of this.links)null!==t.targetElement&&null!==t.sourceElement&&i.push(t.sourceElement.toJSON(e).id);this.outputLength>0&&(e.outputLength=this.outputLength),this.inputLength>0&&(e.inputLength=this.inputLength),n.length>0&&(e.inputs=n),i.length>0&&(e.links=i),""!==this.style&&(e.style=this.style),""!==t&&(e.height=t)}deserialize(e){if(void 0!==e.outputLength&&this.setOutput(e.outputLength),void 0!==e.inputLength&&this.setInput(e.inputLength),void 0!==e.inputs)for(const t of e.inputs)this.add(e.objects[t]);if(void 0!==e.links)for(const t of e.links)this.link(e.objects[t]);void 0!==e.style&&this.setStyle(e.style),void 0!==e.height&&this.setHeight(e.height)}get linkedElement(){return this.links.length>0?this.links[0].sourceElement:null}_createIO(e){const{dom:t}=this,n=document.createElement("f-io");n.style.visibility="hidden",n.className=e;const i=i=>{i.preventDefault(),i.stopPropagation(),c=null;const o=this.node.dom;o.classList.add("io-connect"),n.classList.add("connect"),t.classList.add("select");const r="output"===e?new d(this):new d(null,this);this.links.push(r),s(i,(i=>{if(!1===i.dragging&&(o.classList.remove("io-connect"),n.classList.remove("connect"),t.classList.remove("select"),this.links.splice(this.links.indexOf(r),1),null!==c)){if("output"===e?r.targetElement=c:r.sourceElement=c,r.sourceElement.node.isCircular(r.targetElement.node))return;r.targetElement.inputLength>0&&r.sourceElement.outputLength>0&&r.targetElement.link(r.sourceElement)}}),"connecting")};return n.addEventListener("mousedown",i,!0),n.addEventListener("touchstart",i,!0),n}}h.prototype.isElement=!0;class u extends i{constructor(e){super(),this.dom=e,this.element=null,this.events={change:[],click:[]},this.addEventListener("change",(()=>{o(this.events.change,this)})),this.addEventListener("click",(()=>{o(this.events.click,this)}))}setToolTip(e){const t=document.createElement("f-tooltip");return t.innerText=e,this.dom.appendChild(t),this}onChange(e){return this.events.change.push(e),this}onClick(e){return this.events.click.push(e),this}setValue(e){return this.dom.value=e,this}getValue(){return this.dom.value}serialize(e){e.value=this.getValue()}deserialize(e){this.setValue(e.value)}}class p extends i{constructor(){super();const e=document.createElement("f-node"),t=()=>{const e=this.canvas;null!==e&&e.select(this)};e.addEventListener("mousedown",t,!0),e.addEventListener("touchstart",t,!0),this.dom=e,this.style="",this.canvas=null,this.elements=[]}setStyle(e){const t=this.dom;return this.style&&t.classList.remove(this.style),e&&t.classList.add(e),this.style=e,this}setPosition(e,t){const n=this.dom;return n.style.left=r(e),n.style.top=r(t),this}getPosition(){const e=this.dom;return{x:parseInt(e.style.left),y:parseInt(e.style.top)}}setWidth(e){return this.dom.style.width=r(e),this}getWidth(){return this.dom.style.width}add(e){return this.elements.push(e),e.node=this,this.dom.appendChild(e.dom),this}isCircular(e){if(e===this)return!0;const t=this.getLinks();for(const n of t)if(n.sourceElement.node.isCircular(e))return!0;return!1}getLinks(){const e=[];for(const t of this.elements)e.push(...t.links);return e}serialize(e){const{x:t,y:n,style:i}=this.getPosition(),s=[];for(const t of this.elements)s.push(t.toJSON(e).id);e.x=t,e.y=n,e.width=this.getWidth(),e.elements=s,""!==i&&(e.style=i)}deserialize(e){this.setPosition(e.x,e.y),this.setWidth(e.width);for(const t of e.elements)this.add(e.objects[t]);void 0!==e.style&&this.setStyle(e.style)}}const m=(e,t,n,i,s,o,r,a)=>{const l=100*(s?-1:1);a.beginPath(),a.moveTo(e,t),a.bezierCurveTo(e+l,t,n-l,i,n,i),a.lineWidth=o,a.strokeStyle=r,a.stroke()},g=["#ff4444","#44ff44","#4444ff"];class f extends i{constructor(){super();const e=document.createElement("f-canvas"),t=document.createElement("f-content"),n=document.createElement("f-area"),i=document.createElement("canvas"),o=document.createElement("canvas"),a=i.getContext("2d"),l=o.getContext("2d");this.dom=e,this.contentDOM=t,this.areaDOM=n,this.canvas=i,this.frontCanvas=o,this.context=a,this.frontContext=l,this.width=1e4,this.height=1e4,this.clientX=0,this.clientY=0,this.relativeX=0,this.relativeY=0,this.zoom=1,this.nodes=[],this.selected=null,this.updating=!1,o.className="front",t.style.left=r(this.centerX),t.style.top=r(this.centerY),n.style.width=`calc( 100% + ${this.width}px )`,n.style.height=`calc( 100% + ${this.height}px )`,e.appendChild(i),e.appendChild(o),e.appendChild(t),e.appendChild(n);const d=e=>{e.touches?2===e.touches.length&&(e.preventDefault(),e.stopImmediatePropagation()):(e.preventDefault(),e.stopImmediatePropagation())};e.addEventListener("wheel",d),e.addEventListener("touchmove",d),s(e,(t=>{const{delta:n,isTouch:i}=t;i||(void 0===t.scrollTop&&(t.scrollLeft=e.scrollLeft,t.scrollTop=e.scrollTop),e.scrollLeft=t.scrollLeft-n.x,e.scrollTop=t.scrollTop-n.y),t.dragging?e.classList.add("grabbing"):e.classList.remove("grabbing")}),"dragging-canvas"),this._onMoveEvent=t=>{const n=t.touches?t.touches[0]:t,i=this.zoom,s=e.getBoundingClientRect();this.clientX=n.clientX,this.clientY=n.clientY,this.relativeX=(e.scrollLeft-this.centerX+n.clientX-s.left)/i,this.relativeY=(e.scrollTop-this.centerY+n.clientY-s.top)/i},this._onContentLoaded=()=>{this.centralize()},this._onUpdate=()=>{this.update()},this.start()}get centerX(){return this.width/2}get centerY(){return this.height/2}start(){this.updating=!0,document.addEventListener("wheel",this._onMoveEvent,!0),document.addEventListener("mousedown",this._onMoveEvent,!0),document.addEventListener("touchstart",this._onMoveEvent,!0),document.addEventListener("mousemove",this._onMoveEvent,!0),document.addEventListener("touchmove",this._onMoveEvent,!0),document.addEventListener("DOMContentLoaded",this._onContentLoaded),requestAnimationFrame(this._onUpdate)}stop(){this.updating=!1,document.removeEventListener("wheel",this._onMoveEvent,!0),document.removeEventListener("mousedown",this._onMoveEvent,!0),document.removeEventListener("touchstart",this._onMoveEvent,!0),document.removeEventListener("mousemove",this._onMoveEvent,!0),document.removeEventListener("touchmove",this._onMoveEvent,!0),document.removeEventListener("DOMContentLoaded",this._onContentLoaded)}add(e){return this.nodes.push(e),e.canvas=this,this.contentDOM.appendChild(e.dom),this}remove(e){this.unlink(e);const t=this.nodes;t.splice(t.indexOf(e),1),e.canvas=null,this.contentDOM.removeChild(e.dom)}unlink(e){const t=this.getLinks();for(const n of t)n.sourceElement&&n.sourceElement.node===e&&n.targetElement.link()}getLinks(){const e=[];for(const t of this.nodes)e.push(...t.getLinks());return e}centralize(){return this.dom.scroll(this.centerX,this.centerY),this}select(e=null){null!==this.selected&&this.selected.dom.classList.remove("selected"),null!==e&&e.dom.classList.add("selected"),this.selected=e}update(){if(!1===this.updating)return;requestAnimationFrame(this._onUpdate);const{dom:e,zoom:t,canvas:n,frontCanvas:i,frontContext:s,context:o}=this,r=window.innerWidth,a=window.innerHeight,l=e.getBoundingClientRect();n.width===r&&n.height===a||(n.width=r,n.height=a,i.width=r,i.height=a),o.clearRect(0,0,r,a),s.clearRect(0,0,r,a),o.globalCompositeOperation="lighter",s.globalCompositeOperation="source-over";const d=this.getLinks(),c={x:0,y:0},h={x:0,y:0};let u="";for(const e of d){const{sourceElement:n,targetElement:i}=e;let r="",a=0;if(null!==n){const e=n.dom.getBoundingClientRect();a=Math.max(a,n.outputLength),c.x=e.x+e.width,c.y=e.y+e.height/2}else c.x=this.clientX,c.y=this.clientY,r="input";if(null!==i){const e=i.dom.getBoundingClientRect();a=Math.max(a,i.inputLength),h.x=e.x,h.y=e.y+e.height/2}else h.x=this.clientX,h.y=this.clientY,r="output";u=u||r;const l=r?s:o;if(r||1===a)"output"===r?(c.x+=10,h.x/=t,h.y/=t):"input"===r&&(h.x-=10,c.x/=t,c.y/=t),m(c.x*t,c.y*t,h.x*t,h.y*t,!1,2,"#ffffff",l);else{a=Math.min(a,4);for(let e=0;e<a;e++){const s=g[e]||"#ffffff",o=4,r=Math.min(n.outputLength,a),d=Math.min(i.inputLength,a),u=r*o*.5-o/2,p=d*o*.5-o/2,f=Math.min(e,r-1)*o,x=Math.min(e,d-1)*o;m(c.x*t,(c.y+f-u)*t,h.x*t,(h.y+x-p)*t,!1,2,s,l)}}}o.globalCompositeOperation="destination-in",o.fillRect(l.x,l.y,l.width,l.height),""!==u?e.classList.add("dragging-"+u):(e.classList.remove("dragging-input"),e.classList.remove("dragging-output"))}serialize(e){const t=[];for(const n of this.nodes)t.push(n.toJSON(e).id);e.nodes=t}deserialize(e){for(const t of e.nodes)this.add(e.objects[t])}}class x extends EventTarget{constructor(){super()}async load(e){return await fetch(e).then((e=>e.json())).then((e=>this.parse(e))).catch((e=>{console.error("Loader:",e)}))}parse(e){e={...e};const n={};for(const i in e.objects){const s=e.objects[i];s.objects=n,n[i]=new t[s.type]}for(const t in e.objects)n[t].deserialize(e.objects[t]);e.objects=n;const i=new t[e.type];return i.deserialize(e),i}}class b extends u{constructor(e=""){const t=document.createElement("input");super(t),t.type="text",t.value=e,t.spellcheck=!1,t.autocomplete="off",t.onblur=()=>{this.dispatchEvent(new Event("blur"))},t.onchange=()=>{this.dispatchEvent(new Event("change"))},t.onkeydown=e=>{13===e.keyCode&&e.target.blur(),e.stopPropagation()}}}class v extends u{constructor(e=0,t=-1/0,n=1/0,i=.01){const o=document.createElement("input");super(o),this.min=t,this.max=n,this.step=i,this.integer=!1,o.type="text",o.className="number",o.value=this._getString(e),o.spellcheck=!1,o.autocomplete="off",o.onblur=()=>{this.dispatchEvent(new Event("blur"))},o.onkeydown=e=>{if(1===e.key.length&&!0!==/\d|\/./.test(e.key))return!1;this.dispatchEvent(new Event("change")),13===e.keyCode&&e.target.blur(),e.stopPropagation()},s(o,(e=>{const{delta:t}=e;void 0===e.value&&(e.value=this.getValue());const n=t.x-t.y,i=e.value+n*this.step;this.dom.value=this._getString(i.toFixed(this.precision)),this.dispatchEvent(new Event("change"))}))}setRange(e,t,n){return this.min=e,this.max=t,this.step=n,this.dom.value=this._getString(this.value),this.dispatchEvent(new Event("range")),this.dispatchEvent(new Event("change")),this}get precision(){if(!0===this.integer)return 0;const e=this.step%1;return 0!==e?e.toString().split(".")[1].length:1}setValue(e){return this.dom.value=this._getString(e),this}getValue(){return Number(this.dom.value)}serialize(e){const{min:t,max:n}=this;t!==-1/0&&n!==1/0&&(e.min=this.min,e.max=this.max,e.step=this.step),super.serialize(e)}deserialize(e){if(void 0!==e.min){const{min:e,max:t,step:n}=this;this.setRange(e,t,n)}super.deserialize(e)}_getString(e){let t=Math.min(Math.max(Number(e),this.min),this.max);return!0===this.integer?Math.floor(t):t+(t%1?"":".0")}}const w=(e,t)=>.001*(t-e);class y extends u{constructor(e=0,t=0,n=100){const i=document.createElement("f-subinputs");super(i),e=Math.min(Math.max(e,t),n);const o=w(t,n),r=document.createElement("input");r.type="range",r.min=t,r.max=n,r.step=o,r.value=e;const a=new v(e,t,n,o);a.dom.className="range-value",a.onChange((()=>{r.value=a.getValue()})),a.addEventListener("range",(()=>{r.min=a.min,r.max=a.max,r.step=a.step,r.value=a.getValue()})),i.appendChild(r),i.appendChild(a.dom),this.min=t,this.max=n,this.step=o,this.rangeDOM=r,this.field=a;const l=()=>{let e=Number(r.value);e!==this.max&&e+this.step>=this.max&&(r.value=e=this.max),this.field.setValue(e)};s(r,(()=>{l(),this.dispatchEvent(new Event("change"))}),"")}setRange(e,t){return this.field.setRange(e,t,w(e,t)),this.dispatchEvent(new Event("range")),this.dispatchEvent(new Event("change")),this}setValue(e){return this.field.setValue(e),this.rangeDOM.value=e,this}getValue(){return this.field.getValue()}serialize(e){e.min=this.min,e.max=this.max,super.serialize(e)}deserialize(e){const{min:t,max:n}=e;this.setRange(t,n),super.deserialize(e)}}class E extends u{constructor(e=39423){const t=document.createElement("input");super(t),t.type="color",t.value=a(e)}}class L extends u{constructor(e=""){const t=document.createElement("textarea");super(t),t.innerText=e}setValue(e){return this.dom.innerText=e,this}getValue(){return this.dom.innerText}}class k extends u{constructor(e=""){const t=document.createElement("button"),n=document.createElement("span");t.appendChild(n);const i=document.createElement("i");t.appendChild(i),super(t),this.spanDOM=n,this.iconDOM=i,n.innerText=e,t.onclick=()=>{this.dispatchEvent(new Event("click"))}}setIcon(e){return this.iconDOM.className=e,this}setValue(e){return this.spanDOM.innerText=e,this}getValue(){return this.spanDOM.innerText}}class M extends h{constructor(e="",t=""){super(),this.labelDOM=document.createElement("f-label"),this.inputsDOM=document.createElement("f-inputs");const n=document.createElement("span"),i=document.createElement("i");this.spanDOM=n,this.iconDOM=i,this.labelDOM.appendChild(this.spanDOM),this.labelDOM.appendChild(this.iconDOM),this.dom.appendChild(this.labelDOM),this.dom.appendChild(this.inputsDOM),this.setLabel(e),this.setAlign(t)}setIcon(e){return this.iconDOM.className=e,this}getIcon(){return this.iconDOM.className}setAlign(e){this.labelDOM.className=e}setLabel(e){this.spanDOM.innerText=e}getLabel(){return this.spanDOM.innerText}serialize(e){super.serialize(e);const t=this.getLabel(),n=this.getIcon();e.label=t,""!==n&&(e.icon=n)}deserialize(e){super.deserialize(e),this.setLabel(e.label),void 0!==e.icon&&this.setIcon(e.icon)}}class O extends h{constructor(e=!0){super(!0),this.draggable=e;const t=e=>{e.preventDefault(),!0===this.draggable&&s(this.node.dom)},{dom:n}=this;n.addEventListener("mousedown",t,!0),n.addEventListener("touchstart",t,!0)}}class C extends O{constructor(e,t=!0){super(t);const{dom:n}=this;n.className="title";const i=document.createElement("span");i.innerText=e;const s=document.createElement("i"),o=document.createElement("f-toolbar");this.buttons=[],this.spanDOM=i,this.iconDOM=s,this.toolbarDOM=o,n.appendChild(i),n.appendChild(s),n.appendChild(o)}setIcon(e){return this.iconDOM.className=e,this}getIcon(){return this.iconDOM.className}setTitle(e){return this.spanDOM.innerText=e,this}getTitle(){return this.spanDOM.innerText}addButton(e){return this.buttons.push(e),this.toolbarDOM.appendChild(e.dom),this}serialize(e){super.serialize(e);const t=this.getTitle(),n=this.getIcon();e.title=t,""!==n&&(e.icon=n)}deserialize(e){super.deserialize(e),this.setTitle(e.title),void 0!==e.icon&&this.setIcon(e.icon)}}class z extends p{constructor(e="Panel",t="top-right"){super();const n=new C(e);this.add(n);const i=new k("🗕");i.onClick((()=>{this.setCollapse(!this.collapsed)})),n.addButton(i),this.collapseButton=i,this.titleElement=n,this.align=t,this.collapsed=!1,this.setAlign(t),this.setStyle("rouded")}setCollapse(e){const t="closed";return this.dom.classList.remove(t),this.collapsed=e,this.collapseButton.value=e?"🗖":"🗕",!0===e&&this.dom.classList.add(t),this}setAlign(e){return this.align&&this.dom.classList.remove(this.align),this.dom.classList.add(e),this.align=e,this}addInput(e,t,n,...i){const s=new e(t[n],...i);return s.onChange((()=>{t[n]=s.value})),this.add(new M(n).add(s)),s}addSlider(e,t,n,i){return this.addInput(y,e,t,n,i)}addNumber(e,t){return this.addInput(v,e,t)}addColor(e,t){return this.addInput(E,e,t)}addString(e,t){return this.addInput(b,e,t)}addText(e,t){const n=this.addInput(L,e,t);return n.element.setHeight(70),n}addButton(e){const t=new k(e);return this.add((new h).setHeight(34).add(t)),t}}class D{constructor(e,t=null){const n=document.createElement("f-menu");n.className=e+" hidden",this.dom=n,this.visible=!1,this.setTarget(t)}show(e,t){return this.setPosition(e,t),this.dom.classList.remove("hidden"),this.visible=!0,this}hide(){this.dom.classList.add("hidden"),this.visible=!1}setTarget(e=null){if(null!==e){const t=e=>{e.preventDefault();const t=this.target.getBoundingClientRect();this.show(e.pageX-t.left,e.pageY-t.top)},n=e=>{!0===this.visible&&null===e.target.closest("f-menu")&&this.hide()};this.target=e,e.addEventListener("mousedown",n,!0),e.addEventListener("touchstart",n,!0),e.addEventListener("contextmenu",t,!1)}return this}add(e,t=null){const n=document.createElement("f-item");null!==t&&(n.classList.add("submenu"),n.appendChild(t.dom)),n.appendChild(e.dom),this.dom.appendChild(n)}setPosition(e,t){const n=this.dom;return n.style.left=r(e),n.style.top=r(t),this}}class T extends D{constructor(e=null){super("context",e)}}class I extends D{constructor(e=null){super("circle",e)}}class _ extends u{constructor(e=[]){const t=document.createElement("select");super(t),t.onchange=()=>{this.dispatchEvent(new Event("change"))},this.setOptions(e)}setOptions(e){const t=this.dom;this.options=e,t.innerHTML="";for(let n=0;n<e.length;n++){let i=e[n];"string"==typeof i&&(i={name:i,value:n});const s=document.createElement("option");s.innerText=i.name,s.value=i.value,t.appendChild(s)}return this}getOptions(){return this._options}serialize(e){e.options=[...this.options],super.serialize(e)}deserialize(e){this.setOptions(e.options),super.deserialize(e)}}class S extends u{constructor(e=!1){const t=document.createElement("input");super(t),t.type="checkbox",t.className="toggle",t.checked=e}setValue(e){return this.dom.checked=e,this}getValue(){return this.dom.checked}}e.ButtonInput=k,e.Canvas=f,e.CircleMenu=I,e.ColorInput=E,e.ContextMenu=T,e.DraggableElement=O,e.Element=h,e.Input=u,e.LabelElement=M,e.Loader=x,e.Menu=D,e.Node=p,e.NumberInput=v,e.PanelNode=z,e.SelectInput=_,e.Serializer=i,e.SliderInput=y,e.StringInput=b,e.TextInput=L,e.TitleElement=C,e.ToggleInput=S,e.Utils=l,Object.defineProperty(e,"__esModule",{value:!0})}));
