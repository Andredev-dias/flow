/**
 * https://github.com/sunag/flow
 */
function __flow__addCSS(t){try{const e=document.createElement("style");e.setAttribute("type","text/css"),e.innerHTML=t,document.head.appendChild(e)}catch(t){}}__flow__addCSS("@keyframes f-animation-open { 0% { transform: scale(.5); filter: blur(30px); } 100% { transform: scale(1); filter: unset; }}f-canvas,f-canvas canvas { position: absolute; top: 0; left: 0; margin: 0; padding: 0; width: 100%; height: 100%; -webkit-touch-callout: none; }f-canvas { overflow: auto; cursor: grab;}f-canvas canvas.front { z-index: 10;}body.dragging f-canvas,body.connecting f-canvas { overflow: hidden !important;}body.dragging *:not(.drag) { pointer-events: none !important;}f-canvas.grabbing * { cursor: grabbing; user-select: none;}f-canvas canvas { position: fixed; overflow: hidden; pointer-events: none;}f-canvas::-webkit-scrollbar { width: 8px; height: 8px;}f-canvas::-webkit-scrollbar-thumb:hover{ background: #014fc5;}f-canvas::-webkit-scrollbar-track { background: #363636;}f-canvas::-webkit-scrollbar-thumb { background-color: #666666; border-radius: 10px; border: 0;}f-canvas f-content,f-canvas f-area { position: absolute; display: block;}f-node { position: absolute; margin: 0; padding: 0; user-select: none; width: 320px; z-index: 1; cursor: auto; filter: drop-shadow(0 0 10px #00000061); backdrop-filter: blur(4px);}f-node.selected { z-index: 2;}f-node.selected,f-canvas.dragging-rio f-node:hover,f-canvas.dragging-lio f-node:hover { filter: drop-shadow(0 0 10px #00000061) drop-shadow(0 0 8px #4444dd);}f-node.closed f-element:not(:first-child) { display: none;}f-node.center { top: 50%; left: 50%; transform: translate( -50%, -50% );}f-node.top-right { top: 0; right: 0;}f-node.top-center { top: 0; left: 50%; transform: translateX( -50% );}f-node.top-left { top: 0; left: 0;}f-node { transition: filter 0.2s ease;}f-node { animation: .2s f-animation-open 1 alternate ease-out;}f-drop,f-menu,f-menu button,f-element,f-element input,f-element select,f-element button,f-element textarea { font-family: 'Open Sans', sans-serif; font-size: 13px; text-transform: capitalize; color: #eeeeee; outline: solid 0px #000; letter-spacing: .2px; margin: 0; padding: 0; border: 0; user-select: none; -webkit-tap-highlight-color: transparent; transition: background 0.2s ease;}f-element input { transition: background 0.1s ease;}f-element input,f-element select,f-element button,f-element textarea { background-color: #242427;}f-element { position: relative; width: calc( 100% - 14px ); background: rgba(45, 45, 48, 0.95); pointer-events: auto; border-bottom: 2px solid #232323; display: flex; padding-left: 7px; padding-right: 7px; padding-top: 2px; padding-bottom: 2px;}f-element { height: 24px;}f-element input { margin-top: 2px; margin-bottom: 2px; box-shadow: inset 0px 1px 1px rgb(0 0 0 / 20%), 0px 1px 0px rgb(255 255 255 / 5%); margin-left: 2px; margin-right: 2px; width: 100%; padding-left: 4px; padding-right: 4px;}f-element input.number { cursor: col-resize;}f-element input:focus[type='text'], f-element input:focus[type='range'], f-element input:focus[type='color'] { background: rgba( 0, 0, 0, 0.6 ); outline: solid 1px rgba( 0, 80, 200, 0.98 );}f-element input[type='color'] { appearance: none; padding: 0; margin-left: 2px; margin-right: 2px; height: calc( 100% - 4px ); margin-top: 2px; border: none; }f-element input[type='color']::-webkit-color-swatch-wrapper { padding: 2px;}f-element input[type='color']::-webkit-color-swatch { border: none; cursor: alias;}f-element input[type='range'] { appearance: none; width: 100%; overflow: hidden; padding: 0; cursor: ew-resize;}f-element input[type='range']::-webkit-slider-runnable-track { appearance: none; height: 10px; color: #13bba4; margin: 0;}f-element input[type='range']::-webkit-slider-thumb { appearance: none; width: 0; background: #434343; box-shadow: -500px 0 0 500px rgba( 0, 120, 255, 0.98 ); border-radius: 50%; border: 0 !important;}f-element input[type='range']::-webkit-slider-runnable-track { margin-left: -4px; margin-right: -5px;}f-element input[type='checkbox'] { appearance: none; cursor: pointer;}f-element input[type='checkbox'].toggle { height: 20px; width: 45px; border-radius: 16px; display: inline-block; position: relative; margin: 0; margin-top: 2px; background: linear-gradient( 0deg, #292929 0%, #0a0a0ac2 100% ); transition: all 0.2s ease;}f-element input[type='checkbox'].toggle:after { content: \"\"; position: absolute; top: 2px; left: 2px; width: 16px; height: 16px; border-radius: 50%; background: white; box-shadow: 0 1px 2px rgba(44, 44, 44, 0.2); transition: all 0.2s cubic-bezier(0.5, 0.1, 0.75, 1.35);}f-element input[type='checkbox'].toggle:checked { background: linear-gradient( 0deg, #0177fb 0%, #0177fb 100% );}f-element input[type='checkbox'].toggle:checked:after { transform: translatex(25px);}f-element.auto-height { display: table;}f-element textarea { width: calc( 100% - 18px ); padding-top: 1px; padding-bottom: 3px; padding-left: 3px; padding-right: 8px; margin-top: 2px; margin-left: 2px; height: calc( 100% - 8px ); max-height: 300px; border-radius: 2px; resize: none; box-shadow: inset 0px 1px 1px rgb(0 0 0 / 20%), 0px 1px 0px rgb(255 255 255 / 5%);}f-element.auto-height textarea { resize: auto;}f-element select { width: 100%; margin-top: 2px; margin-bottom: 2px; margin-left: 2px; margin-right: 2px; padding-left: 5px; cursor: pointer; box-shadow: inset 0px 1px 1px rgb(0 0 0 / 20%), 0px 1px 0px rgb(255 255 255 / 5%);}f-element f-toolbar { position: absolute; display: flex; top: 0; width: 100%; height: 100%; align-content: space-around;}f-element.output-right f-toolbar { right: 7px; float: right; justify-content: end;}f-element f-toolbar { margin-top: auto; margin-bottom: auto; margin-left: 3px; margin-right: 3px; font-size: 18px; line-height: 18px;}f-element f-toolbar button { opacity: .7; cursor: pointer; font-size: 14px; width: unset; height: unset; border-radius: unset; border: unset; outline: 0; background-color: unset; box-shadow: unset;}f-element f-toolbar button:hover,f-element f-toolbar button:active { opacity: 1; border: 0; background-color: unset;}f-element input.range-value { width: 60px; text-align: center;}f-menu.context button,f-element button { width: 100%; height: calc( 100% - 4px ); margin-left: 2px; margin-right: 2px; margin-top: 2px; border-radius: 3px; cursor: pointer;}f-element button { box-shadow: inset 1px 1px 1px 0 rgb(255 255 255 / 17%), inset -2px -2px 2px 0 rgb(0 0 0 / 26%);}f-element button:hover { color: #fff; background-color: #2a2a2a;}f-element button:active { border: 1px solid rgba( 0, 120, 255, 0.98 );}f-element f-inputs,f-element f-subinputs { display: flex; width: 100%;}f-element f-inputs { left: 100px; top: 50%; transform: translateY(-50%); position: absolute; width: calc( 100% - 106px ); height: calc( 100% - 4px ); z-index: 1;}f-element f-label,f-element span { margin: auto; text-shadow: 1px 1px 0px #0007;}f-element f-label { padding-left: 4px; white-space: nowrap; position: absolute; top: 50%; transform: translateY(-50%); width: calc( 100% - 20px );}f-element.right f-label { text-align: right;}f-element f-label i { float: left; font-size: 18px; margin-right: 6px;}f-element f-label.center { width: 100%; text-align: center; display: block;}f-element.title { height: 29px; background-color: #3a3a3ab0; background-color: #3b3b43ed; cursor: all-scroll; border-top-left-radius: 6px; border-top-right-radius: 6px;}f-element.blue { background-color: #014fc5;}f-element.red { background-color: #bd0b0b;}f-element.green { background-color: #148d05;}f-element.yellow { background-color: #d6b100;}f-element.title.left { text-align: left; display: inline-grid; justify-content: start;}f-element.title span { text-align: center; font-size: 15px; padding-top: 2px;}f-element.title i { font-size: 18px; position: absolute; right: 10px; top: 50%; transform: translateY(-50%); opacity: .5;}f-element.output-right.title i { left: 10px; right: unset;}f-element.title.left span { text-align: left;}f-element f-io { border: 2px solid #dadada; width: 7px; height: 7px; position: absolute; background: #242427; border-radius: 8px; float: left; left: -7px; top: calc( 50% - 5px ); cursor: alias; box-shadow: 0 0 3px 2px #0000005e; z-index: 1;}f-element f-io.connect,f-canvas.dragging-rio f-element:hover f-io.lio,f-canvas.dragging-lio f-element:hover f-io.rio { border: 2px solid #0177fb; zoom: 1.4;}f-node.io-connect f-io:not(.connect) { border: 2px solid #dadada !important; zoom: 1 !important;}f-element f-io.rio { float: right; right: -7px; left: unset;}f-element f-disconnect { position: absolute; left: -35px; top: 50%; font-size: 22px; transform: translateY( -50% ); filter: drop-shadow(0 0 5px #000); text-shadow: 0px 0px 5px black; cursor: pointer;}f-element.output-right f-disconnect { right: -35px; left: unset;}f-element f-disconnect:hover { color: #ff3300;}f-element textarea::-webkit-scrollbar { width: 6px;}f-element textarea::-webkit-scrollbar-track { background: #111; } f-element textarea::-webkit-scrollbar-thumb { background: #0177fb; }f-element textarea::-webkit-scrollbar-thumb:hover { background: #1187ff; }f-element.small { height: 18px;}f-element.large { height: 36px;}body.connecting f-node:not(.io-connect) f-element:hover,f-element.select { background-color: rgba(61, 70, 82, 0.98);}f-drop { width: 100%; height: 100%; position: sticky; left: 0; top: 0; background: #02358417; text-align: center; justify-content: center; align-items: center; display: flex; box-shadow: inset 0 0 20px 10px #464ace17; pointer-events: none; transition: all .07s; opacity: 0; visibility: hidden;}f-drop.visible { visibility: unset; opacity: unset; transition: all .23s;}f-drop span { opacity: .5; font-size: 40px; text-shadow: 0px 0px 5px #000; font-weight: bold;}f-tooltip { pointer-events: none;}f-tooltip { position: absolute; left: 0; top: 0; background: rgba(0,0,0,.8); backdrop-filter: blur(4px); font-size: 14px; padding: 7px; border-radius: 10px; top: 50%; transform: translateY(-50%); visibility: hidden; pointer-events: none; opacity: 0; transition: all 0.3s ease; z-index: 150; white-space: nowrap;}f-menu.context { position: absolute; width: 170px; padding: 2px; margin: 0; background: #17171794; z-index: 110; font-size: 12px; border-radius: 6px; backdrop-filter: blur(6px); border: 1px solid #7e7e7e45; box-shadow: 3px 3px 6px rgba(0,0,0,.2); transition: opacity 0.2s ease, transform 0.1s ease;}f-menu.context.hidden { visibility: hidden; opacity: 0;}f-menu.context f-item { display: block; position: relative; margin: 0; padding: 0; white-space: nowrap;}f-menu.context f-item.submenu::after { content: \"\"; position: absolute; right: 6px; top: 50%; -webkit-transform: translateY(-50%); transform: translateY(-50%); border: 5px solid transparent; border-left-color: #808080;}f-menu.context f-item:hover > f-menu,f-menu.context f-item.active > f-menu { visibility: unset; transform: unset; opacity: unset;}f-menu.context f-menu { top: 0px; left: calc( 100% - 4px );}f-menu.context f-item button { overflow: visible; display: block; width: calc( 100% - 6px ); text-align: left; cursor: pointer; white-space: nowrap; padding: 6px 8px; border-radius: 3px; background: #2d2d32; border: 0; color: #ddd; margin: 3px; text-shadow: 1px 1px 0px #0007;}f-menu.context f-item button i { float: left; font-size: 16px;}f-menu.context f-item button span { margin-left: 6px;}f-menu.context f-item:hover > button,f-menu.context f-item.active > button { color: #fff; background: #313136;}f-menu.context f-item button:active { outline: solid 1px rgba( 0, 80, 200, 0.98 );}f-menu.context f-item f-tooltip { margin-left: 120px;}f-menu.circle { position: absolute; left: 30px; top: 30px; z-index: 100;}f-menu.circle f-item { display: flex; justify-content: end; align-content: space-around; margin-bottom: 12px;}f-menu.circle f-item button { width: 50px; height: 50px; font-size: 26px; background: #17171794; border-radius: 50%; backdrop-filter: blur(6px); border: 1px solid #7e7e7e45; line-height: 100%; cursor: pointer; box-shadow: 3px 3px 6px rgba(0,0,0,.2);}f-menu.circle f-item f-tooltip { margin-left: 50px;}.f-rounded f-node f-element,.f-rounded f-node f-element.title.left { border-radius: 10px 5px 10px 5px;}.f-rounded f-node f-element input, .f-rounded f-node f-element select,.f-rounded f-node f-element button,.f-rounded f-node f-element textarea,.f-rounded f-node f-element input[type='checkbox'].toggle,.f-rounded f-node f-element input[type='checkbox'].toggle:after { border-radius: 20px 10px;}.f-rounded f-node f-element input { padding-left: 7px; padding-right: 7px;}.f-rounded f-menu.context,.f-rounded f-menu.context f-item button { border-radius: 20px 10px;}@media (hover: hover) and (pointer: fine) { f-element f-io:hover { border: 2px solid #0177fb; zoom: 1.4; } f-menu.circle f-item button:hover { background-color: #2a2a2a; } f-menu.circle f-item button:hover > f-tooltip, f-menu.context f-item button:hover > f-tooltip { visibility: visible; transform: translate(10px, -50%); opacity: 1; } f-menu.circle f-item button:focus > f-tooltip, f-menu.context f-item button:focus > f-tooltip { visibility: hidden; opacity: 0; }}f-canvas { will-change: top, left;}f-node { will-change: transform !important;}"),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Flow={})}(this,(function(t){"use strict";let e=0;class n extends EventTarget{constructor(){super(),this._id=e++,this._serializable=!0}get id(){return this._id}setSerializable(t){return this._serializable=t,this}getSerializable(){return this._serializable}serialize(){console.warn("Serializer: Abstract function.")}deserialize(){console.warn("Serializer: Abstract function.")}toJSON(t=null){let e=null;const n=this.id;if(null!==t){const i=t.objects;e=i[n],void 0===e&&(e={objects:i},this.serialize(e),delete e.objects,i[n]=e)}else e={objects:{}},this.serialize(e);return e.id=n,e.type=this.constructor.name,e}}const i=(t,e=null,n="dragging")=>{let i=null;const s=e=>{const n=e.touches?e.touches[0]:e;e.stopImmediatePropagation(),i={client:{x:n.clientX,y:n.clientY},delta:{x:0,y:0},start:{x:t.offsetLeft,y:t.offsetTop},dragging:!1,isTouch:!!e.touches},window.addEventListener("mousemove",o),window.addEventListener("mouseup",r),window.addEventListener("touchmove",o),window.addEventListener("touchend",r)},o=s=>{const{start:o,delta:r,client:l}=i,a=s.touches?s.touches[0]:s,d=(()=>{let e=t;for(;e&&e!==document;){const t=e.style.zoom;if(t)return Number(t);e=e.parentNode}return 1})();r.x=(a.clientX-l.x)/d,r.y=(a.clientY-l.y)/d,i.x=o.x+r.x,i.y=o.y+r.y,!0===i.dragging?(null!==e?e(i):t.style.cssText+=`; left: ${i.x}px; top: ${i.y}px;`,s.stopImmediatePropagation()):(Math.abs(r.x)>2||Math.abs(r.y)>2)&&(i.dragging=!0,t.classList.add("drag"),n&&document.body.classList.add(n),s.stopImmediatePropagation())},r=l=>{l.stopImmediatePropagation(),t.classList.remove("drag"),n&&document.body.classList.remove(n),window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",r),window.removeEventListener("touchmove",o),window.removeEventListener("touchend",r),null===e&&(t.removeEventListener("mousedown",s),t.removeEventListener("touchstart",s)),i.dragging=!1,null!==e&&e(i)};if(t instanceof Event){const e=t;t=e.target,s(e)}else t.addEventListener("mousedown",s),t.addEventListener("touchstart",s)},s=(t,...e)=>{for(const n of t)n(...e)},o=t=>(!1===isNaN(t)&&(t=`${t}px`),t),r=t=>(!1===isNaN(t)&&(t=`#${t.toString(16).padStart(6,"0")}`),t);var l=Object.freeze({__proto__:null,draggableDOM:i,dispatchEventList:s,toPX:o,toHex:r});class a{constructor(t=null,e=null){this.inputElement=t,this.outputElement=e}get lioElement(){return"left"===a.InputDirection?this.outputElement:this.inputElement}get rioElement(){return"left"===a.InputDirection?this.inputElement:this.outputElement}}a.InputDirection="left";let d=null;class c extends n{constructor(t=!1){super();const e=document.createElement("f-element");e.element=this;const n=t=>{let e=this;if(t.changedTouches&&t.changedTouches.length>0){const n=t.changedTouches[0];let i=document.elementFromPoint(n.clientX,n.clientY);for(;i&&(!i.element||!i.element.isElement);)i=i.parentNode;e=i?i.element:null}d=e};!1===t&&(e.ontouchstart=e.onmousedown=t=>{t.stopPropagation()}),e.addEventListener("mouseup",n,!0),e.addEventListener("touchend",n),this.inputs=[],this.links=[],this.dom=e,this.lioLength=0,this.rioLength=0,this.events={connect:[],connectChildren:[]},this.node=null,this.style="",this.extra=null,this.visible=!0,this.inputsDOM=e,this.disconnectDOM=null,this.lioDOM=this._createIO("lio"),this.rioDOM=this._createIO("rio"),this.dom.classList.add(`output-${a.InputDirection}`),this.dom.appendChild(this.lioDOM),this.dom.appendChild(this.rioDOM),this.addEventListener("connect",(()=>{s(this.events.connect,this)})),this.addEventListener("connectChildren",(()=>{s(this.events.connectChildren,this)}))}onConnect(t,e=!1){return this.events.connect.push(t),e&&this.events.connectChildren.push(t),this}setExtra(t){return this.extra=t,this}getExtra(){return this.extra}setVisible(t){return this.visible=t,this.dom.style.display=t?"":"none",this}getVisible(){return this.visible}setStyle(t){const e=this.dom;return this.style&&e.classList.remove(this.style),t&&e.classList.add(t),this.style=t,this}setInput(t){return"left"===a.InputDirection?this.setLIO(t):this.setRIO(t)}setOutput(t){return"left"===a.InputDirection?this.setRIO(t):this.setLIO(t)}get inputLength(){return"left"===a.InputDirection?this.lioLength:this.rioLength}get outputLength(){return"left"===a.InputDirection?this.rioLength:this.lioLength}setLIO(t){return this.lioLength=t,this.lioDOM.style.visibility=t>0?"":"hidden",this}setRIO(t){return this.rioLength=t,this.rioDOM.style.visibility=t>0?"":"hidden",this}add(t){return this.inputs.push(t),t.element=this,this.inputsDOM.appendChild(t.dom),this}setHeight(t){return this.dom.style.height=o(t),this}getHeight(){return this.dom.style.height}connect(t=null){if(null!==this.disconnectDOM&&this.disconnectDOM.dispatchEvent(new Event("disconnect")),null!==t){const e=new a(this,t);if(this.links.push(e),null===this.disconnectDOM){this.disconnectDOM=document.createElement("f-disconnect"),this.disconnectDOM.innerText="✖",this.dom.appendChild(this.disconnectDOM);const e=()=>{this.links=[],this.dom.removeChild(this.disconnectDOM),this.disconnectDOM.removeEventListener("mousedown",s,!0),this.disconnectDOM.removeEventListener("touchstart",s,!0),this.disconnectDOM.removeEventListener("disconnect",e,!0),t.removeEventListener("connect",n),t.removeEventListener("connectChildren",n),t.removeEventListener("nodeConnect",n),t.removeEventListener("nodeConnectChildren",n),t.removeEventListener("dispose",i),this.disconnectDOM=null},n=t=>{this.dispatchEvent(new Event("connectChildren"))},i=()=>{this.connect()},s=t=>{t.stopPropagation(),this.connect()};this.disconnectDOM.addEventListener("mousedown",s,!0),this.disconnectDOM.addEventListener("touchstart",s,!0),this.disconnectDOM.addEventListener("disconnect",e,!0),t.addEventListener("connect",n),t.addEventListener("connectChildren",n),t.addEventListener("nodeConnect",n),t.addEventListener("nodeConnectChildren",n),t.addEventListener("dispose",i)}}return this.dispatchEvent(new Event("connect")),this}dispose(){this.dispatchEvent(new Event("dispose"))}serialize(t){const e=this.getHeight(),n=[],i=[];for(const e of this.inputs)n.push(e.toJSON(t).id);for(const e of this.links)null!==e.inputElement&&null!==e.outputElement&&i.push(e.outputElement.toJSON(t).id);this.inputLength>0&&(t.inputLength=this.inputLength),this.outputLength>0&&(t.outputLength=this.outputLength),n.length>0&&(t.inputs=n),i.length>0&&(t.links=i),""!==this.style&&(t.style=this.style),""!==e&&(t.height=e)}deserialize(t){if(void 0!==t.inputLength&&this.setInput(t.inputLength),void 0!==t.outputLength&&this.setOutput(t.outputLength),void 0!==t.inputs){const e=this.inputs;if(e.length>0){let n=0;for(const i of t.inputs)t.objects[i]=e[n++]}else for(const e of t.inputs)this.add(t.objects[e])}if(void 0!==t.links)for(const e of t.links)this.connect(t.objects[e]);void 0!==t.style&&this.setStyle(t.style),void 0!==t.height&&this.setHeight(t.height)}get linkedExtra(){const t=this.linkedElement;return t?t.getExtra():null}get linkedElement(){const t=this.link;return t?t.outputElement:null}get link(){return this.links[0]}_createIO(t){const{dom:e}=this,n=document.createElement("f-io");n.style.visibility="hidden",n.className=t;const s=s=>{s.preventDefault(),s.stopPropagation(),d=null;const o=this.node.dom;o.classList.add("io-connect"),n.classList.add("connect"),e.classList.add("select");const r="left"===a.InputDirection?"lio":"rio",l=t===r?new a(this):new a(null,this);this.links.push(l),i(s,(i=>{if(!1===i.dragging&&(o.classList.remove("io-connect"),n.classList.remove("connect"),e.classList.remove("select"),this.links.splice(this.links.indexOf(l),1),null!==d)){if(t===r?l.outputElement=d:l.inputElement=d,l.outputElement.node.isCircular(l.inputElement.node))return;l.inputElement.inputLength>0&&l.outputElement.outputLength>0&&l.inputElement.connect(l.outputElement)}}),"connecting")};return n.addEventListener("mousedown",s,!0),n.addEventListener("touchstart",s,!0),n}}c.prototype.isElement=!0;class h extends n{constructor(t){super(),this.dom=t,this.element=null,this.extra=null,this.events={change:[],click:[]},this.addEventListener("change",(()=>{s(this.events.change,this)})),this.addEventListener("click",(()=>{s(this.events.click,this)}))}setExtra(t){return this.extra=t,this}getExtra(){return this.extra}setToolTip(t){const e=document.createElement("f-tooltip");return e.innerText=t,this.dom.appendChild(e),this}onChange(t){return this.events.change.push(t),this}onClick(t){return this.events.click.push(t),this}setValue(t,e=!0){return this.dom.value=t,e&&this.dispatchEvent(new Event("change")),this}getValue(){return this.dom.value}serialize(t){t.value=this.getValue()}deserialize(t){this.setValue(t.value)}}h.prototype.isInput=!0;class u extends n{constructor(){super();const t=document.createElement("f-node"),e=()=>{const t=this.canvas;null!==t&&t.select(this)};t.addEventListener("mousedown",e,!0),t.addEventListener("touchstart",e,!0),this._onConnect=t=>{const{target:e}=t;for(const t of this.elements)t!==e&&t.dispatchEvent(new Event("nodeConnect"))},this._onConnectChildren=t=>{const{target:e}=t;for(const t of this.elements)t!==e&&t.dispatchEvent(new Event("nodeConnectChildren"))},this.dom=t,this.style="",this.canvas=null,this.elements=[],this.events={focus:[],blur:[]},this.setWidth(300).setPosition(0,0)}onFocus(t){return this.events.focus.push(t),this}onBlur(t){return this.events.blur.push(t),this}setStyle(t){const e=this.dom;return this.style&&e.classList.remove(this.style),t&&e.classList.add(t),this.style=t,this}setPosition(t,e){const n=this.dom;return n.style.left=o(t),n.style.top=o(e),this}getPosition(){const t=this.dom;return{x:parseInt(t.style.left),y:parseInt(t.style.top)}}setWidth(t){return this.dom.style.width=o(t),this}getWidth(){return parseInt(this.dom.style.width)}add(t){return this.elements.push(t),t.node=this,t.addEventListener("connect",this._onConnect),t.addEventListener("connectChildren",this._onConnectChildren),this.dom.appendChild(t.dom),this}remove(t){return this.elements.splice(this.elements.indexOf(t),1),t.node=null,t.removeEventListener("connect",this._onConnect),t.removeEventListener("connectChildren",this._onConnectChildren),this.dom.removeChild(t.dom),this}dispose(){const t=this.canvas;null!==t&&t.remove(this);for(const t of this.elements)t.dispose();this.dispatchEvent(new Event("dispose"))}isCircular(t){if(t===this)return!0;const e=this.getLinks();for(const n of e)if(n.outputElement.node.isCircular(t))return!0;return!1}getLinks(){const t=[];for(const e of this.elements)t.push(...e.links);return t}serialize(t){const{x:e,y:n,style:i}=this.getPosition(),s=[];for(const e of this.elements)s.push(e.toJSON(t).id);t.x=e,t.y=n,t.width=this.getWidth(),t.elements=s,""!==i&&(t.style=i)}deserialize(t){this.setPosition(t.x,t.y),this.setWidth(t.width),void 0!==t.style&&this.setStyle(t.style);const e=this.elements;if(e.length>0){let n=0;for(const i of t.elements)t.objects[i]=e[n++]}else for(const e of t.elements)this.add(t.objects[e])}}u.prototype.isNode=!0;class p extends c{constructor(t=!0){super(!0),this.draggable=t;const e=t=>{t.preventDefault(),!0===this.draggable&&i(this.node.dom)},{dom:n}=this;n.addEventListener("mousedown",e,!0),n.addEventListener("touchstart",e,!0)}}class m extends p{constructor(t,e=!0){super(e);const{dom:n}=this;n.className="title";const i=document.createElement("span");i.innerText=t;const s=document.createElement("i"),o=document.createElement("f-toolbar");this.buttons=[],this.spanDOM=i,this.iconDOM=s,this.toolbarDOM=o,n.appendChild(i),n.appendChild(s),n.appendChild(o)}setIcon(t){return this.iconDOM.className=t,this}getIcon(){return this.iconDOM.className}setTitle(t){return this.spanDOM.innerText=t,this}getTitle(){return this.spanDOM.innerText}addButton(t){return this.buttons.push(t),this.toolbarDOM.appendChild(t.dom),this}serialize(t){super.serialize(t);const e=this.getTitle(),n=this.getIcon();t.title=e,""!==n&&(t.icon=n)}deserialize(t){super.deserialize(t),this.setTitle(t.title),void 0!==t.icon&&this.setIcon(t.icon)}}const f=(t,e,n,i,s,o,r,l)=>{const a=100*(s?-1:1);l.beginPath(),l.moveTo(t,e),l.bezierCurveTo(t+a,e,n-a,i,n,i),l.lineWidth=o,l.strokeStyle=r,l.stroke()},g=["#ff4444","#44ff44","#4444ff"],x=(new u).add(new m("File")).setWidth(250);class v extends n{constructor(){super();const t=document.createElement("f-canvas"),e=document.createElement("f-content"),n=document.createElement("f-area"),r=document.createElement("f-drop"),l=document.createElement("canvas"),a=document.createElement("canvas"),d=l.getContext("2d"),c=a.getContext("2d");this.dom=t,this.contentDOM=e,this.areaDOM=n,this.dropDOM=r,this.canvas=l,this.frontCanvas=a,this.context=d,this.frontContext=c,this.width=1e4,this.height=1e4,this.clientX=0,this.clientY=0,this.relativeClientX=0,this.relativeClientY=0,this.zoom=1,this.nodes=[],this.selected=null,this.updating=!1,this.droppedItems=[],this.events={drop:[]},a.className="front",e.style.left=o(this.centerX),e.style.top=o(this.centerY),n.style.width=`calc( 100% + ${this.width}px )`,n.style.height=`calc( 100% + ${this.height}px )`,r.innerHTML="<span>drop your file</span>",t.appendChild(r),t.appendChild(l),t.appendChild(a),t.appendChild(e),t.appendChild(n);const h=t=>{t.touches?2===t.touches.length&&(t.preventDefault(),t.stopImmediatePropagation()):(t.preventDefault(),t.stopImmediatePropagation())};t.addEventListener("wheel",h),t.addEventListener("touchmove",h);let u=0;const p=t=>{t?0==u++&&(this.droppedItems=[],r.classList.add("visible"),this.add(x)):0==--u&&(r.classList.remove("visible"),this.remove(x))};t.addEventListener("dragenter",(()=>{p(!0)})),t.addEventListener("dragleave",(()=>{p(!1)})),t.addEventListener("dragover",(t=>{t.preventDefault();const{relativeClientX:e,relativeClientY:n}=this,i=x.getWidth()/2;x.setPosition(e-i,n-20)})),t.addEventListener("drop",(t=>{t.preventDefault(),p(!1),this.droppedItems=t.dataTransfer.items,s(this.events.drop,this)})),i(t,(e=>{const{delta:n,isTouch:i}=e;i||(void 0===e.scrollTop&&(e.scrollLeft=t.scrollLeft,e.scrollTop=t.scrollTop),t.scrollLeft=e.scrollLeft-n.x,t.scrollTop=e.scrollTop-n.y),e.dragging?t.classList.add("grabbing"):t.classList.remove("grabbing")}),"dragging-canvas"),this._onMoveEvent=e=>{const n=e.touches?e.touches[0]:e,{zoom:i,rect:s}=this;this.clientX=n.clientX,this.clientY=n.clientY,this.relativeClientX=(t.scrollLeft-this.centerX+n.clientX-s.left)/i,this.relativeClientY=(t.scrollTop-this.centerY+n.clientY-s.top)/i},this._onContentLoaded=()=>{this.centralize()},this._onUpdate=()=>{this.update()},this.start()}get rect(){return this.dom.getBoundingClientRect()}get relativeX(){return this.dom.scrollLeft-this.centerX}get relativeY(){return this.dom.scrollTop-this.centerY}get centerX(){return this.width/2}get centerY(){return this.height/2}onDrop(t){return this.events.drop.push(t),this}start(){this.updating=!0,document.addEventListener("wheel",this._onMoveEvent,!0),document.addEventListener("mousedown",this._onMoveEvent,!0),document.addEventListener("touchstart",this._onMoveEvent,!0),document.addEventListener("mousemove",this._onMoveEvent,!0),document.addEventListener("touchmove",this._onMoveEvent,!0),document.addEventListener("dragover",this._onMoveEvent,!0),document.addEventListener("DOMContentLoaded",this._onContentLoaded),requestAnimationFrame(this._onUpdate)}stop(){this.updating=!1,document.removeEventListener("wheel",this._onMoveEvent,!0),document.removeEventListener("mousedown",this._onMoveEvent,!0),document.removeEventListener("touchstart",this._onMoveEvent,!0),document.removeEventListener("mousemove",this._onMoveEvent,!0),document.removeEventListener("touchmove",this._onMoveEvent,!0),document.removeEventListener("dragover",this._onMoveEvent,!0),document.removeEventListener("DOMContentLoaded",this._onContentLoaded)}add(t){return this.nodes.push(t),t.canvas=this,this.contentDOM.appendChild(t.dom),this}remove(t){t===this.selected&&this.select(),this.unlink(t);const e=this.nodes;return e.splice(e.indexOf(t),1),t.canvas=null,this.contentDOM.removeChild(t.dom),this}clear(){const t=this.nodes;for(;t.length>0;)this.remove(t[0]);return this}unlink(t){const e=this.getLinks();for(const n of e)n.outputElement&&n.outputElement.node===t&&n.inputElement.connect()}getLinks(){const t=[];for(const e of this.nodes)t.push(...e.getLinks());return t}centralize(){return this.dom.scroll(this.centerX,this.centerY),this}select(t=null){if(t===this.selected)return;const e=this.selected;null!==e&&(e.dom.classList.remove("selected"),this.selected=null,s(e.events.blur,e)),null!==t&&(t.dom.classList.add("selected"),this.selected=t,s(t.events.focus,t))}update(){if(!1===this.updating)return;requestAnimationFrame(this._onUpdate);const{dom:t,zoom:e,canvas:n,frontCanvas:i,frontContext:s,context:o}=this,r=window.innerWidth,l=window.innerHeight,a=this.rect;n.width===r&&n.height===l||(n.width=r,n.height=l,i.width=r,i.height=l),o.clearRect(0,0,r,l),s.clearRect(0,0,r,l),o.globalCompositeOperation="lighter",s.globalCompositeOperation="source-over";const d=this.getLinks(),c={x:0,y:0},h={x:0,y:0};let u="";for(const t of d){const{lioElement:n,rioElement:i}=t;let r="",l=0;if(null!==n){const t=n.dom.getBoundingClientRect();l=Math.max(l,n.rioLength),c.x=t.x+t.width,c.y=t.y+t.height/2}else c.x=this.clientX,c.y=this.clientY,r="lio";if(null!==i){const t=i.dom.getBoundingClientRect();l=Math.max(l,i.lioLength),h.x=t.x,h.y=t.y+t.height/2}else h.x=this.clientX,h.y=this.clientY,r="rio";u=u||r;const a=r?s:o;if(r||1===l)"rio"===r?(c.x+=10,h.x/=e,h.y/=e):"lio"===r&&(h.x-=10,c.x/=e,c.y/=e),f(c.x*e,c.y*e,h.x*e,h.y*e,!1,2,"#ffffff",a);else{l=Math.min(l,4);for(let t=0;t<l;t++){const s=g[t]||"#ffffff",o=4,r=Math.min(n.rioLength,l),d=Math.min(i.lioLength,l),u=r*o*.5-o/2,p=d*o*.5-o/2,m=Math.min(t,r-1)*o,x=Math.min(t,d-1)*o;f(c.x*e,(c.y+m-u)*e,h.x*e,(h.y+x-p)*e,!1,2,s,a)}}}o.globalCompositeOperation="destination-in",o.fillRect(a.x,a.y,a.width,a.height),""!==u?t.classList.add("dragging-"+u):(t.classList.remove("dragging-lio"),t.classList.remove("dragging-rio"))}serialize(t){const e=[];for(const n of this.nodes)e.push(n.toJSON(t).id);t.nodes=e}deserialize(t){for(const e of t.nodes)this.add(t.objects[e])}}class b extends h{constructor(t=""){const e=document.createElement("button"),n=document.createElement("span");e.appendChild(n);const i=document.createElement("i");e.appendChild(i),super(e),this.spanDOM=n,this.iconDOM=i,n.innerText=t,e.onmouseover=()=>{this.dispatchEvent(new Event("mouseover"))},e.onclick=e.ontouchstart=t=>{t.preventDefault(),t.stopPropagation(),this.dispatchEvent(new Event("click"))}}setIcon(t){return this.iconDOM.className=t,this}setValue(t){return this.spanDOM.innerText=t,this}getValue(){return this.spanDOM.innerText}}class E extends u{constructor(t,e,n=null,i=300){super(),this.setWidth(i);const s=new m(t).setExtra(n).setOutput(e),o=new b("✖").onClick((()=>{this.dispose()}));s.addButton(o),this.add(s),this.title=s,this.closeButton=o}setExtra(t){return this.title.setExtra(t),this}getExtra(t){return this.title.getExtra()}invalidate(){this.title.dispatchEvent(new Event("connect"))}}class w extends h{constructor(t=""){const e=document.createElement("input");super(e),e.type="text",e.value=t,e.spellcheck=!1,e.autocomplete="off",e.onblur=()=>{this.dispatchEvent(new Event("blur"))},e.onchange=()=>{this.dispatchEvent(new Event("change"))},e.onkeyup=t=>{13===t.keyCode&&t.target.blur(),t.stopPropagation(),this.dispatchEvent(new Event("change"))}}}class y extends h{constructor(t=0,e=-1/0,n=1/0,s=.01){const o=document.createElement("input");super(o),this.min=e,this.max=n,this.step=s,this.integer=!1,o.type="text",o.className="number",o.value=this._getString(t),o.spellcheck=!1,o.autocomplete="off",o.ondragstart=o.oncontextmenu=t=>{t.preventDefault(),t.stopPropagation()},o.onfocus=o.onclick=()=>{o.select()},o.onblur=()=>{this.dispatchEvent(new Event("blur"))},o.onchange=()=>{this.dispatchEvent(new Event("change"))},o.onkeydown=t=>{if(1===t.key.length&&!0!==/\d|\./.test(t.key))return!1;13===t.keyCode&&t.target.blur(),t.stopPropagation()},i(o,(t=>{const{delta:e}=t;void 0===t.value&&(t.value=this.getValue());const n=e.x-e.y,i=t.value+n*this.step;this.dom.value=this._getString(i.toFixed(this.precision)),this.dispatchEvent(new Event("change"))}))}setRange(t,e,n){return this.min=t,this.max=e,this.step=n,this.dispatchEvent(new Event("range")),this.setValue(this.getValue())}get precision(){if(!0===this.integer)return 0;const t=this.step%1;return 0!==t?t.toString().split(".")[1].length:1}setValue(t,e=!0){return super.setValue(this._getString(t),e)}getValue(){return Number(this.dom.value)}serialize(t){const{min:e,max:n}=this;e!==-1/0&&n!==1/0&&(t.min=this.min,t.max=this.max,t.step=this.step),super.serialize(t)}deserialize(t){if(void 0!==t.min){const{min:t,max:e,step:n}=this;this.setRange(t,e,n)}super.deserialize(t)}_getString(t){let e=Math.min(Math.max(Number(t),this.min),this.max);return!0===this.integer?Math.floor(e):e+(e%1?"":".0")}}const L=(t,e)=>.001*(e-t);class k extends h{constructor(t=0,e=0,n=100){const s=document.createElement("f-subinputs");super(s),t=Math.min(Math.max(t,e),n);const o=L(e,n),r=document.createElement("input");r.type="range",r.min=e,r.max=n,r.step=o,r.value=t;const l=new y(t,e,n,o);l.dom.className="range-value",l.onChange((()=>{r.value=l.getValue()})),l.addEventListener("range",(()=>{r.min=l.min,r.max=l.max,r.step=l.step,r.value=l.getValue()})),s.appendChild(r),s.appendChild(l.dom),this.rangeDOM=r,this.field=l;const a=()=>{let t=Number(r.value);t!==this.max&&t+this.step>=this.max&&(r.value=t=this.max),this.field.setValue(t)};i(r,(()=>{a(),this.dispatchEvent(new Event("change"))}),"")}get min(){return this.field.min}get max(){return this.field.max}get step(){return this.field.step}setRange(t,e){return this.field.setRange(t,e,L(t,e)),this.dispatchEvent(new Event("range")),this.dispatchEvent(new Event("change")),this}setValue(t,e=!0){return this.field.setValue(t),this.rangeDOM.value=t,e&&this.dispatchEvent(new Event("change")),this}getValue(){return this.field.getValue()}serialize(t){t.min=this.min,t.max=this.max,super.serialize(t)}deserialize(t){const{min:e,max:n}=t;this.setRange(e,n),super.deserialize(t)}}class C extends h{constructor(t=39423){const e=document.createElement("input");super(e),e.type="color",e.value=r(t),e.oninput=()=>{this.dispatchEvent(new Event("change"))}}setValue(t,e=!0){return super.setValue(r(t),e)}getValue(){return parseInt(super.getValue().substr(1),16)}}class M extends h{constructor(t=""){const e=document.createElement("textarea");super(e),e.innerText=t}setValue(t){return this.dom.innerText=t,this}getValue(){return this.dom.innerText}}class O extends c{constructor(t="",e=""){super(),this.labelDOM=document.createElement("f-label"),this.inputsDOM=document.createElement("f-inputs");const n=document.createElement("span"),i=document.createElement("i");this.spanDOM=n,this.iconDOM=i,this.labelDOM.appendChild(this.spanDOM),this.labelDOM.appendChild(this.iconDOM),this.dom.appendChild(this.labelDOM),this.dom.appendChild(this.inputsDOM),this.setLabel(t),this.setAlign(e)}setIcon(t){return this.iconDOM.className=t,this}getIcon(){return this.iconDOM.className}setAlign(t){this.labelDOM.className=t}setLabel(t){this.spanDOM.innerText=t}getLabel(){return this.spanDOM.innerText}serialize(t){super.serialize(t);const e=this.getLabel(),n=this.getIcon();t.label=e,""!==n&&(t.icon=n)}deserialize(t){super.deserialize(t),this.setLabel(t.label),void 0!==t.icon&&this.setIcon(t.icon)}}class D extends u{constructor(t="Panel",e="top-right"){super();const n=new m(t);this.add(n);const i=new b("🗕");i.onClick((()=>{this.setCollapse(!this.collapsed)})),n.addButton(i),this.collapseButton=i,this.titleElement=n,this.align=e,this.collapsed=!1,this.setAlign(e),this.setStyle("rouded")}setCollapse(t){const e="closed";return this.dom.classList.remove(e),this.collapsed=t,this.collapseButton.value=t?"🗖":"🗕",!0===t&&this.dom.classList.add(e),this}setAlign(t){return this.align&&this.dom.classList.remove(this.align),this.dom.classList.add(t),this.align=t,this}addInput(t,e,n,...i){const s=new t(e[n],...i);return s.onChange((()=>{e[n]=s.value})),this.add(new O(n).add(s)),s}addSlider(t,e,n,i){return this.addInput(k,t,e,n,i)}addNumber(t,e){return this.addInput(y,t,e)}addColor(t,e){return this.addInput(C,t,e)}addString(t,e){return this.addInput(w,t,e)}addText(t,e){const n=this.addInput(M,t,e);return n.element.setHeight(70),n}addButton(t){const e=new b(t);return this.add((new c).setHeight(34).add(e)),e}}class z extends EventTarget{constructor(t,e=null){super();const n=document.createElement("f-menu");n.className=t+" hidden",this.dom=n,this.visible=!1,this.subMenus=new WeakMap,this.domButtons=new WeakMap,this.events={context:[]},this.addEventListener("context",(()=>{s(this.events.context,this)})),this._lastButtonClick=null,this._onButtonClick=(t=null)=>{const e=t?t.target:null;this._lastButtonClick&&this._lastButtonClick.dom.parentElement.classList.remove("active"),this._lastButtonClick=e,e&&(this.subMenus.has(e)&&this.subMenus.get(e)._onButtonClick(),e.dom.parentElement.classList.add("active"))},this._onButtonMouseOver=t=>{const e=t.target;this.subMenus.has(e)&&this._lastButtonClick!==e&&this._onButtonClick()},this.setTarget(e)}onContext(t){return this.events.context.push(t),this}show(t=null,e=null){return this._onButtonClick(),null!==t&&null!==e&&this.setPosition(t,e),this.dom.classList.remove("hidden"),this.visible=!0,this.dispatchEvent(new Event("show")),this}hide(){this.dom.classList.add("hidden"),this.dispatchEvent(new Event("hide")),this.visible=!1}setTarget(t=null){if(null!==t){const e=t=>{if(t.preventDefault(),"mouse"!==t.pointerType||0===t.pageX&&0===t.pageY)return;const e=this.target.getBoundingClientRect();this.dispatchEvent(new Event("context")),this.show(t.pageX-e.left,t.pageY-e.top)},n=t=>{!0===this.visible&&null===t.target.closest("f-menu")&&this.hide()};this.target=t,t.addEventListener("mousedown",n,!0),t.addEventListener("touchstart",n,!0),t.addEventListener("contextmenu",e,!1),t.appendChild(this.dom)}return this}add(t,e=null){const n=document.createElement("f-item");return null!==e&&(n.classList.add("submenu"),n.appendChild(e.dom),this.subMenus.set(t,e)),n.appendChild(t.dom),t.addEventListener("click",this._onButtonClick),t.addEventListener("mouseover",this._onButtonMouseOver),this.dom.appendChild(n),this.domButtons.set(n,t),this}setPosition(t,e){const n=this.dom;return n.style.left=o(t),n.style.top=o(e),this}}let I=null;class _ extends z{constructor(t=null){super("context",t)}show(t,e){return null!==I&&I.hide(),I=this,super.show(t,e)}hide(){return I===this&&(I=null),super.hide()}}class T extends z{constructor(t=null){super("circle",t)}}class S extends h{constructor(t=[]){const e=document.createElement("select");super(e),e.onchange=()=>{this.dispatchEvent(new Event("change"))},this.setOptions(t)}setOptions(t){const e=this.dom;this.options=t,e.innerHTML="";for(let n=0;n<t.length;n++){let i=t[n];"string"==typeof i&&(i={name:i,value:n});const s=document.createElement("option");s.innerText=i.name,s.value=i.value,e.appendChild(s)}return this}getOptions(){return this._options}serialize(t){t.options=[...this.options],super.serialize(t)}deserialize(t){this.options.length>0&&this.setOptions(t.options),super.deserialize(t)}}class N extends h{constructor(t=!1){const e=document.createElement("input");super(e),e.type="checkbox",e.className="toggle",e.checked=t}setValue(t){return this.dom.checked=t,this.dispatchEvent(new Event("change")),this}getValue(){return this.dom.checked}}var j=Object.freeze({__proto__:null,Element:c,Input:h,Node:u,Canvas:v,Serializer:n,ObjectNode:E,PanelNode:D,Menu:z,ContextMenu:_,CircleMenu:T,DraggableElement:p,LabelElement:O,TitleElement:m,ButtonInput:b,ColorInput:C,NumberInput:y,SelectInput:S,SliderInput:k,StringInput:w,TextInput:M,ToggleInput:N});class B extends EventTarget{constructor(t=B.DEFAULT){super(),this.parseType=t,this.events={load:[]}}setParseType(t){return this.parseType=t,this}getParseType(){return this.parseType}onLoad(t){return this.events.load.push(t),this}async load(t,e=null){return await fetch(t).then((t=>t.json())).then((t=>(this.data=this.parse(t,e),s(this.events.load,this),this.data))).catch((t=>{console.error("Loader:",t)}))}parse(t,e=null){t=this._parseObjects(t,e);const n=this.parseType;if(n===B.DEFAULT){const e=new j[t.type];return e.getSerializable()&&e.deserialize(t),e}if(n===B.OBJECTS)return t}_parseObjects(t,e=null){t={...t};const n={};for(const i in t.objects){const s=t.objects[i];s.objects=n;const o=e&&e[s.type]?e[s.type]:j[s.type];n[i]=new o}const i=new WeakMap,s=(e=null)=>{for(const s in t.objects){const o=n[s];!1!==i.has(o)||null!==e&&!0!==o[e]||(i.set(o,!0),o.getSerializable()&&o.deserialize(t.objects[s]))}};return s("isNode"),s("isElement"),s("isInput"),s(),t.objects=n,t}}B.DEFAULT="default",B.OBJECTS="objects",t.ButtonInput=b,t.Canvas=v,t.CircleMenu=T,t.ColorInput=C,t.ContextMenu=_,t.DraggableElement=p,t.Element=c,t.Input=h,t.LabelElement=O,t.Loader=B,t.Menu=z,t.Node=u,t.NumberInput=y,t.ObjectNode=E,t.PanelNode=D,t.REVISION="1",t.SelectInput=S,t.Serializer=n,t.SliderInput=k,t.StringInput=w,t.TextInput=M,t.TitleElement=m,t.ToggleInput=N,t.Utils=l,Object.defineProperty(t,"__esModule",{value:!0})}));
